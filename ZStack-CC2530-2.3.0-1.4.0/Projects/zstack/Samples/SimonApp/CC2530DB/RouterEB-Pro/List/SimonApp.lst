###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         23/Nov/2016  16:17:50 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\Source\SimonApp.c        #
#    Command line       =  -f F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Proj #
#                          ects\zstack\Samples\SimonApp\CC2530DB\..\..\..\Too #
#                          ls\CC2530DB\f8wRouter.cfg (-DCPU32MHZ              #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DRTR_NWK -DBLINK_LEDS) -f                       #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\Tools\ #
#                          CC2530DB\f8wConfig.cfg (-DSECURE=0                 #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\Source\SimonApp.c -D     #
#                          ZIGBEEPRO -D ZTOOL_P1 -D MT_TASK -D MT_SYS_FUNC    #
#                          -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -D           #
#                          NV_RESTORE -D NV_INIT -lC                          #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\RouterEB-Pro\Li #
#                          st\ -lA F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0 #
#                          \Projects\zstack\Samples\SimonApp\CC2530DB\RouterE #
#                          B-Pro\List\ --diag_suppress Pe001,Pa010 -o         #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\RouterEB-Pro\Ob #
#                          j\ -e --debug --core=plain --dptr=16,1             #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Proj #
#                          ects\zstack\Samples\SimonApp\CC2530DB\ -I          #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\SOURCE\ -I   #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\ZMAIN\ #
#                          TI2530DB\ -I F:\GitHub\ZigBee\ZStack-CC2530-2.3.0- #
#                          1.4.0\Projects\zstack\Samples\SimonApp\CC2530DB\.. #
#                          \..\..\..\..\COMPONENTS\MT\ -I                     #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\HAL\INCLUDE\ -I                         #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\HAL\TARGET\CC2530EB\ -I                 #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\OSAL\MCU\CCSOC\ -I                      #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\OSAL\INCLUDE\ -I                        #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\STACK\AF\ -I F:\GitHub\ZigBee\ZStack-CC #
#                          2530-2.3.0-1.4.0\Projects\zstack\Samples\SimonApp\ #
#                          CC2530DB\..\..\..\..\..\COMPONENTS\STACK\NWK\ -I   #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\STACK\SEC\ -I                           #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\STACK\SAPI\ -I                          #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\STACK\SYS\ -I                           #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\STACK\ZDO\ -I                           #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\ZMAC\F8W\ -I F:\GitHub\ZigBee\ZStack-CC #
#                          2530-2.3.0-1.4.0\Projects\zstack\Samples\SimonApp\ #
#                          CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\ -I        #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\SERVICES\SADDR\ -I                      #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\SERVICES\SDATA\ -I                      #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\MAC\INCLUDE\ -I                         #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\MAC\HIGH_LEVEL\ -I                      #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\MAC\LOW_LEVEL\srf04\ -I                 #
#                          F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\ -Ohz   #
#                          --require_prototypes                               #
#    List file          =  F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\RouterEB-Pro\Li #
#                          st\SimonApp.lst                                    #
#    Object file        =  F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Project #
#                          s\zstack\Samples\SimonApp\CC2530DB\RouterEB-Pro\Ob #
#                          j\SimonApp.r51                                     #
#                                                                             #
#                                                                             #
###############################################################################

F:\GitHub\ZigBee\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\Samples\SimonApp\Source\SimonApp.c
      1          /**************************************************************************************************
      2            Filename:       SimonApp.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6            Description:    Generic Application (no Profile).
      7          
      8          
      9            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends "Hello World" to another "Generic"
     45            application every 15 seconds.  The application will also
     46            receive "Hello World" packets.
     47          
     48            The "Hello World" messages are sent/received as MSG type message.
     49          
     50            This applications doesn't have a profile, so it handles everything
     51            directly - itself.
     52          
     53            Key control:
     54              SW1:
     55              SW2:  initiates end device binding
     56              SW3:
     57              SW4:  initiates a match description request
     58          *********************************************************************/
     59          
     60          /*********************************************************************
     61           * INCLUDES
     62           */
     63          #include "OSAL.h"
     64          #include "AF.h"
     65          #include "ZDApp.h"
     66          #include "ZDObject.h"
     67          #include "ZDProfile.h"
     68          
     69          #include "SimonApp.h"
     70          #include "DebugTrace.h"
     71          
     72          #include "modules/74LS164_8LED.h" 
     73          
     74          #if !defined( WIN32 )
     75            #include "OnBoard.h"
     76          #endif
     77          
     78          /* HAL */
     79          #include "hal_lcd.h"
     80          #include "hal_led.h"
     81          #include "hal_key.h"
     82          #include "hal_uart.h"
     83          
     84          /*********************************************************************
     85           * MACROS
     86           */
     87          
     88          /*********************************************************************
     89           * CONSTANTS
     90           */
     91          
     92          /*********************************************************************
     93           * TYPEDEFS
     94           */
     95          
     96          /*********************************************************************
     97           * GLOBAL VARIABLES
     98           */
     99          
    100          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    101          const cId_t SimonApp_ClusterList[SimonApp_MAX_CLUSTERS] =
   \                     SimonApp_ClusterList:
   \   000000   0100         DW 1
    102          {
    103            SimonApp_CLUSTERID
    104          };
    105          

   \                                 In  segment XDATA_ROM_C, align 1
    106          const SimpleDescriptionFormat_t SimonApp_SimpleDesc =
   \                     SimonApp_SimpleDesc:
   \   000000   0A           DB 10
   \   000001   040F         DW 3844
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   01           DB 1
   \   000007   ....         DW SimonApp_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW SimonApp_ClusterList
    107          {
    108            SimonApp_ENDPOINT,              //  int Endpoint;
    109            SimonApp_PROFID,                //  uint16 AppProfId[2];
    110            SimonApp_DEVICEID,              //  uint16 AppDeviceId[2];
    111            SimonApp_DEVICE_VERSION,        //  int   AppDevVer:4;
    112            SimonApp_FLAGS,                 //  int   AppFlags:4;
    113            SimonApp_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    114            (cId_t *)SimonApp_ClusterList,  //  byte *pAppInClusterList;
    115            SimonApp_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    116            (cId_t *)SimonApp_ClusterList   //  byte *pAppInClusterList;
    117          };
    118          
    119          // This is the Endpoint/Interface description.  It is defined here, but
    120          // filled-in in SimonApp_Init().  Another way to go would be to fill
    121          // in the structure here and make it a "const" (in code space).  The
    122          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    123          endPointDesc_t SimonApp_epDesc;
   \                     SimonApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    124          
    125          /*********************************************************************
    126           * EXTERNAL VARIABLES
    127           */
    128          
    129          /*********************************************************************
    130           * EXTERNAL FUNCTIONS
    131           */
    132          
    133          /*********************************************************************
    134           * LOCAL VARIABLES
    135           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    136          byte SimonApp_TaskID;   // Task ID for internal task/event processing
   \                     SimonApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    137                                    // This variable will be received when
    138                                    // SimonApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    139          devStates_t SimonApp_NwkState;
   \                     SimonApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    140          
    141          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          byte SimonApp_TransID;  // This is the unique message ID (counter)
   \                     SimonApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    143          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          afAddrType_t SimonApp_DstAddr;
   \                     SimonApp_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    145          
    146          /*added by Simon*/
    147          #define UART_MAX 112

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    148          unsigned char uartbuf[UART_MAX]={0};
   \                     uartbuf:
   \   000000                DS 112
   \   000070                REQUIRE __INIT_XDATA_Z
    149          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    150          uint8 DEV_FLAG=0;
   \                     DEV_FLAG:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    151          
    152          
    153          /*********************************************************************
    154           * LOCAL FUNCTIONS
    155           */
    156          void SimonApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    157          void SimonApp_HandleKeys( byte shift, byte keys );
    158          void SimonApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    159          void SimonApp_SendTheMessage( void );
    160          void SimonApp_SendTheSerial(void);
    161          
    162          /*added by Simon*/
    163          static void rxCB(uint8 port,uint8 event); 
    164          
    165          /*********************************************************************
    166           * NETWORK LAYER CALLBACKS
    167           */
    168          
    169          /*********************************************************************
    170           * PUBLIC FUNCTIONS
    171           */
    172          
    173          /*********************************************************************
    174           * @fn      SimonApp_Init
    175           *
    176           * @brief   Initialization function for the Generic App Task.
    177           *          This is called during initialization and should contain
    178           *          any application specific initialization (ie. hardware
    179           *          initialization/setup, table initialization, power up
    180           *          notificaiton ... ).
    181           *
    182           * @param   task_id - the ID assigned by OSAL.  This ID should be
    183           *                    used to send messages and set timers.
    184           *
    185           * @return  none
    186           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    187          void SimonApp_Init( byte task_id )
   \                     SimonApp_Init:
    188          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV     A,#-0x1d
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
    189            SimonApp_TaskID = task_id;
   \   00000B   90....       MOV     DPTR,#SimonApp_TaskID
   \   00000E   F0           MOVX    @DPTR,A
    190            SimonApp_NwkState = DEV_INIT;
   \   00000F   90....       MOV     DPTR,#SimonApp_NwkState
   \   000012   7401         MOV     A,#0x1
   \   000014   F0           MOVX    @DPTR,A
    191            SimonApp_TransID = 0;
   \   000015   90....       MOV     DPTR,#SimonApp_TransID
   \   000018   E4           CLR     A
   \   000019   F0           MOVX    @DPTR,A
    192            
    193            /*added by Simon*/
    194            halUARTCfg_t uartConfig;
    195            
    196          
    197            // Device hardware initialization can be added here or in main() (Zmain.c).
    198            // If the hardware is application specific - add it here.
    199            // If the hardware is other parts of the device add it in main().
    200          
    201            SimonApp_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent;
   \   00001A   90....       MOV     DPTR,#SimonApp_DstAddr + 8
   \   00001D   F0           MOVX    @DPTR,A
    202            SimonApp_DstAddr.endPoint = 0;
   \   00001E   A3           INC     DPTR
   \   00001F   F0           MOVX    @DPTR,A
    203            SimonApp_DstAddr.addr.shortAddr = 0;
   \   000020   90....       MOV     DPTR,#SimonApp_DstAddr
   \   000023   F0           MOVX    @DPTR,A
   \   000024   A3           INC     DPTR
   \   000025   F0           MOVX    @DPTR,A
    204          
    205            // Fill out the endpoint description.
    206            SimonApp_epDesc.endPoint = SimonApp_ENDPOINT;
   \   000026   90....       MOV     DPTR,#SimonApp_epDesc
   \   000029   740A         MOV     A,#0xa
   \   00002B   F0           MOVX    @DPTR,A
    207            SimonApp_epDesc.task_id = &SimonApp_TaskID;
   \   00002C   A3           INC     DPTR
   \   00002D   74..         MOV     A,#SimonApp_TaskID & 0xff
   \   00002F   F0           MOVX    @DPTR,A
   \   000030   A3           INC     DPTR
   \   000031   74..         MOV     A,#(SimonApp_TaskID >> 8) & 0xff
   \   000033   F0           MOVX    @DPTR,A
    208            SimonApp_epDesc.simpleDesc
    209                      = (SimpleDescriptionFormat_t *)&SimonApp_SimpleDesc;
   \   000034   A3           INC     DPTR
   \   000035   74..         MOV     A,#SimonApp_SimpleDesc & 0xff
   \   000037   F0           MOVX    @DPTR,A
   \   000038   A3           INC     DPTR
   \   000039   74..         MOV     A,#(SimonApp_SimpleDesc >> 8) & 0xff
   \   00003B   F0           MOVX    @DPTR,A
    210            SimonApp_epDesc.latencyReq = noLatencyReqs;
   \   00003C   A3           INC     DPTR
   \   00003D   E4           CLR     A
   \   00003E   F0           MOVX    @DPTR,A
    211          
    212            // Register the endpoint description with the AF
    213            afRegister( &SimonApp_epDesc );
   \   00003F                ; Setup parameters for call to function afRegister
   \   00003F   7A..         MOV     R2,#SimonApp_epDesc & 0xff
   \   000041   7B..         MOV     R3,#(SimonApp_epDesc >> 8) & 0xff
   \   000043   12....       LCALL   ??afRegister?relay
    214            
    215            /*added by Simon*/
    216            uartConfig.configured = TRUE;
   \   000046   85..82       MOV     DPL,?XSP + 0
   \   000049   85..83       MOV     DPH,?XSP + 1
   \   00004C   7401         MOV     A,#0x1
   \   00004E   F0           MOVX    @DPTR,A
    217            uartConfig.baudRate = HAL_UART_BR_115200;
   \   00004F   12....       LCALL   ?XSTACK_DISP0_8
   \   000052   7404         MOV     A,#0x4
   \   000054   F0           MOVX    @DPTR,A
    218            uartConfig.flowControl = FALSE;
   \   000055   7402         MOV     A,#0x2
   \   000057   12....       LCALL   ?XSTACK_DISP0_8
   \   00005A   E4           CLR     A
   \   00005B   F0           MOVX    @DPTR,A
    219            uartConfig.callBackFunc = rxCB;
   \   00005C   741B         MOV     A,#0x1b
   \   00005E   12....       LCALL   ?XSTACK_DISP0_8
   \   000061   74..         MOV     A,#??rxCB?relay & 0xff
   \   000063   F0           MOVX    @DPTR,A
   \   000064   A3           INC     DPTR
   \   000065   74..         MOV     A,#(??rxCB?relay >> 8) & 0xff
   \   000067   F0           MOVX    @DPTR,A
    220            HalUARTOpen(0,&uartConfig);
   \   000068                ; Setup parameters for call to function HalUARTOpen
   \   000068   85..82       MOV     DPL,?XSP + 0
   \   00006B   85..83       MOV     DPH,?XSP + 1
   \   00006E   AA82         MOV     R2,DPL
   \   000070   AB83         MOV     R3,DPH
   \   000072   7900         MOV     R1,#0x0
   \   000074   12....       LCALL   ??HalUARTOpen?relay
    221          
    222            // Register for all key events - This app will handle all key events
    223            RegisterForKeys( SimonApp_TaskID );
   \   000077                ; Setup parameters for call to function RegisterForKeys
   \   000077   90....       MOV     DPTR,#SimonApp_TaskID
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   F9           MOV     R1,A
   \   00007C   12....       LCALL   ??RegisterForKeys?relay
    224          
    225            // Update the display
    226          #if defined ( LCD_SUPPORTED )
    227              HalLcdWriteString( "SimonApp", HAL_LCD_LINE_1 );
   \   00007F                ; Setup parameters for call to function HalLcdWriteString
   \   00007F   7901         MOV     R1,#0x1
   \   000081   7A..         MOV     R2,#`?<Constant "SimonApp">` & 0xff
   \   000083   7B..         MOV     R3,#(`?<Constant "SimonApp">` >> 8) & 0xff
   \   000085   12....       LCALL   ??HalLcdWriteString?relay
    228          #endif
    229              
    230            ZDO_RegisterForZDOMsg( SimonApp_TaskID, End_Device_Bind_rsp );
   \   000088                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000088   7A20         MOV     R2,#0x20
   \   00008A   7B80         MOV     R3,#-0x80
   \   00008C   90....       MOV     DPTR,#SimonApp_TaskID
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   F9           MOV     R1,A
   \   000091   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    231            ZDO_RegisterForZDOMsg( SimonApp_TaskID, Match_Desc_rsp );
   \   000094                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000094   7A06         MOV     R2,#0x6
   \   000096   7B80         MOV     R3,#-0x80
   \   000098   90....       MOV     DPTR,#SimonApp_TaskID
   \   00009B   E0           MOVX    A,@DPTR
   \   00009C   F9           MOV     R1,A
   \   00009D   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    232          }
   \   0000A0   741D         MOV     A,#0x1d
   \   0000A2   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000A5                REQUIRE ?Subroutine0
   \   0000A5                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    233          
    234          /*********************************************************************
    235           * @fn      SimonApp_ProcessEvent
    236           *
    237           * @brief   Generic Application Task event processor.  This function
    238           *          is called to process all events for the task.  Events
    239           *          include timers, messages and any other user defined events.
    240           *
    241           * @param   task_id  - The OSAL assigned task ID.
    242           * @param   events - events to process.  This is a bit map and can
    243           *                   contain more than one event.
    244           *
    245           * @return  none
    246           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    247          UINT16 SimonApp_ProcessEvent( byte task_id, UINT16 events )
   \                     SimonApp_ProcessEvent:
    248          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    249            afIncomingMSGPacket_t *MSGpkt;
    250            afDataConfirm_t *afDataConfirm;
    251          
    252            // Data Confirmation message fields
    253            byte sentEP;
    254            ZStatus_t sentStatus;
    255            byte sentTransID;       // This should match the value sent
    256            (void)task_id;  // Intentionally unreferenced parameter
    257          
    258            if ( events & SYS_EVENT_MSG )
   \   000009   EB           MOV     A,R3
   \   00000A   5480         ANL     A,#0x80
   \   00000C   7003         JNZ     $+5
   \   00000E   02....       LJMP    ??SimonApp_ProcessEvent_0 & 0xFFFF
    259            {
    260              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SimonApp_TaskID );
   \   000011                ; Setup parameters for call to function osal_msg_receive
   \   000011   8042         SJMP    ??SimonApp_ProcessEvent_1
    261              while ( MSGpkt )
    262              {
    263                switch ( MSGpkt->hdr.event )
    264                {
    265                  case ZDO_CB_MSG:
    266                    SimonApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    267                    break;
    268                    
    269                  case KEY_CHANGE:
    270                    SimonApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    271                    break;
    272          
    273                  case AF_DATA_CONFIRM_CMD:
    274                    // This message is received as a confirmation of a data packet sent.
    275                    // The status is of ZStatus_t type [defined in ZComDef.h]
    276                    // The message fields are defined in AF.h
    277                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    278                    sentEP = afDataConfirm->endpoint;
    279                    sentStatus = afDataConfirm->hdr.status;
    280                    sentTransID = afDataConfirm->transID;
    281                    (void)sentEP;
    282                    (void)sentTransID;
    283          
    284                    // Action taken when confirmation is received.
    285                    if ( sentStatus != ZSuccess )
    286                    {
    287                      // The data wasn't delivered -- Do something
    288                    }
    289                    break;
    290          
    291                  case AF_INCOMING_MSG_CMD:
    292                    SimonApp_MessageMSGCB( MSGpkt );
    293                    break;
    294          
    295                  case ZDO_STATE_CHANGE:
    296                    SimonApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \                     ??SimonApp_ProcessEvent_2:
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   90....       MOV     DPTR,#SimonApp_NwkState
   \   000018   F0           MOVX    @DPTR,A
    297                    if ( (SimonApp_NwkState == DEV_ZB_COORD)
    298                        || (SimonApp_NwkState == DEV_ROUTER)
    299                        || (SimonApp_NwkState == DEV_END_DEVICE) )
    300                    {
    301                      // Start sending "the" message in a regular interval.
    302          //            osal_start_timerEx( SimonApp_TaskID,
    303          //                                SimonApp_SEND_MSG_EVT,
    304          //                              SimonApp_SEND_MSG_TIMEOUT );
    305                    }
    306                    
    307                    if(SimonApp_NwkState == DEV_ZB_COORD)
   \   000019   6409         XRL     A,#0x9
   \   00001B   700B         JNZ     ??SimonApp_ProcessEvent_3
    308                    {
    309                      DEV_FLAG = 1;//1-->Cordinator
   \   00001D   90....       MOV     DPTR,#DEV_FLAG
   \   000020   7401         MOV     A,#0x1
   \   000022   F0           MOVX    @DPTR,A
    310                      LS164_BYTE(11);
   \   000023                ; Setup parameters for call to function LS164_BYTE
   \   000023   790B         MOV     R1,#0xb
   \   000025   12....       LCALL   ??LS164_BYTE?relay
    311                      //osal_set_event(SimonApp_TaskID,SimonApp_SEND_MSG_EVT);
    312          //            osal_start_timerEx( SimonApp_TaskID,
    313          //                        SimonApp_SEND_MSG_EVT,
    314          //                      SimonApp_SEND_MSG_TIMEOUT );
    315                       
    316                    }
    317                    
    318                    if(SimonApp_NwkState == DEV_ROUTER)
   \                     ??SimonApp_ProcessEvent_3:
   \   000028   90....       MOV     DPTR,#SimonApp_NwkState
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   6407         XRL     A,#0x7
   \   00002E   700B         JNZ     ??SimonApp_ProcessEvent_4
    319                    {
    320                      DEV_FLAG = 2;//2-->Router
   \   000030   90....       MOV     DPTR,#DEV_FLAG
   \   000033   7402         MOV     A,#0x2
   \   000035   F0           MOVX    @DPTR,A
    321                       LS164_BYTE(12);
   \   000036                ; Setup parameters for call to function LS164_BYTE
   \   000036   790C         MOV     R1,#0xc
   \   000038   12....       LCALL   ??LS164_BYTE?relay
    322                      
    323                    }
    324                    
    325                    if(SimonApp_NwkState == DEV_END_DEVICE)
   \                     ??SimonApp_ProcessEvent_4:
   \   00003B   90....       MOV     DPTR,#SimonApp_NwkState
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   6406         XRL     A,#0x6
   \   000041   700B         JNZ     ??SimonApp_ProcessEvent_5
    326                    {
    327                       DEV_FLAG = 3;//3-->EndDevice
   \   000043   90....       MOV     DPTR,#DEV_FLAG
   \   000046   7403         MOV     A,#0x3
   \   000048   F0           MOVX    @DPTR,A
    328                       LS164_BYTE(13);
   \   000049                ; Setup parameters for call to function LS164_BYTE
   \   000049   790D         MOV     R1,#0xd
   \                     ??SimonApp_ProcessEvent_6:
   \   00004B   12....       LCALL   ??LS164_BYTE?relay
    329                    }
    330                    break;
    331          
    332                  default:
    333                    break;
    334                }
    335          
    336                // Release the memory
    337                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??SimonApp_ProcessEvent_5:
   \   00004E                ; Setup parameters for call to function osal_msg_deallocate
   \   00004E   EE           MOV     A,R6
   \   00004F   FA           MOV     R2,A
   \   000050   EF           MOV     A,R7
   \   000051   FB           MOV     R3,A
   \   000052   12....       LCALL   ??osal_msg_deallocate?relay
    338          
    339                // Next
    340                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SimonApp_TaskID );
   \   000055                ; Setup parameters for call to function osal_msg_receive
   \                     ??SimonApp_ProcessEvent_1:
   \   000055   90....       MOV     DPTR,#SimonApp_TaskID
   \   000058   E0           MOVX    A,@DPTR
   \   000059   F9           MOV     R1,A
   \   00005A   12....       LCALL   ??osal_msg_receive?relay
   \   00005D   8A..         MOV     ?V0 + 2,R2
   \   00005F   8B..         MOV     ?V0 + 3,R3
   \   000061   AE..         MOV     R6,?V0 + 2
   \   000063   AF..         MOV     R7,?V0 + 3
   \   000065   EE           MOV     A,R6
   \   000066   4F           ORL     A,R7
   \   000067   602E         JZ      ??SimonApp_ProcessEvent_7
   \   000069   8E82         MOV     DPL,R6
   \   00006B   8F83         MOV     DPH,R7
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   24E6         ADD     A,#-0x1a
   \   000070   601C         JZ      ??SimonApp_ProcessEvent_8
   \   000072   245A         ADD     A,#0x5a
   \   000074   6011         JZ      ??SimonApp_ProcessEvent_9
   \   000076   24EF         ADD     A,#-0x11
   \   000078   6099         JZ      ??SimonApp_ProcessEvent_2
   \   00007A   24FE         ADD     A,#-0x2
   \   00007C   70D0         JNZ     ??SimonApp_ProcessEvent_5
   \   00007E                ; Setup parameters for call to function SimonApp_ProcessZDOMsgs
   \   00007E   EE           MOV     A,R6
   \   00007F   FA           MOV     R2,A
   \   000080   EF           MOV     A,R7
   \   000081   FB           MOV     R3,A
   \   000082   12....       LCALL   ??SimonApp_ProcessZDOMsgs?relay
   \   000085   80C7         SJMP    ??SimonApp_ProcessEvent_5
   \                     ??SimonApp_ProcessEvent_9:
   \   000087                ; Setup parameters for call to function LS164_BYTE
   \   000087   A3           INC     DPTR
   \   000088   A3           INC     DPTR
   \   000089   A3           INC     DPTR
   \   00008A   E0           MOVX    A,@DPTR
   \   00008B   F9           MOV     R1,A
   \   00008C   80BD         SJMP    ??SimonApp_ProcessEvent_6
   \                     ??SimonApp_ProcessEvent_8:
   \   00008E                ; Setup parameters for call to function SimonApp_MessageMSGCB
   \   00008E   EE           MOV     A,R6
   \   00008F   FA           MOV     R2,A
   \   000090   EF           MOV     A,R7
   \   000091   FB           MOV     R3,A
   \   000092   12....       LCALL   ??SimonApp_MessageMSGCB?relay
   \   000095   80B7         SJMP    ??SimonApp_ProcessEvent_5
    341              }
    342          
    343              // return unprocessed events
    344              return (events ^ SYS_EVENT_MSG);
   \                     ??SimonApp_ProcessEvent_7:
   \   000097   AA..         MOV     R2,?V0 + 0
   \   000099   E5..         MOV     A,?V0 + 1
   \   00009B   6480         XRL     A,#0x80
   \   00009D   FB           MOV     R3,A
   \   00009E   8023         SJMP    ??SimonApp_ProcessEvent_10
    345            }
    346          
    347            // Send a message out - This event is generated by a timer
    348            //  (setup in SimonApp_Init()).
    349            
    350            
    351            /*added  by Simon*/
    352             if ( events & Serial_CallBack_EVT )
   \                     ??SimonApp_ProcessEvent_0:
   \   0000A0   EA           MOV     A,R2
   \   0000A1   5402         ANL     A,#0x2
   \   0000A3   600C         JZ      ??SimonApp_ProcessEvent_11
    353             {
    354               SimonApp_SendTheSerial();
   \   0000A5                ; Setup parameters for call to function SimonApp_SendTheSerial
   \   0000A5   12....       LCALL   ??SimonApp_SendTheSerial?relay
    355               return (events ^ Serial_CallBack_EVT);
   \   0000A8   E5..         MOV     A,?V0 + 0
   \   0000AA   6402         XRL     A,#0x2
   \                     ??SimonApp_ProcessEvent_12:
   \   0000AC   FA           MOV     R2,A
   \   0000AD   AB..         MOV     R3,?V0 + 1
   \   0000AF   8012         SJMP    ??SimonApp_ProcessEvent_10
    356             }
    357            
    358            
    359            if ( events & SimonApp_SEND_MSG_EVT )
   \                     ??SimonApp_ProcessEvent_11:
   \   0000B1   EA           MOV     A,R2
   \   0000B2   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000B4   5009         JNC     ??SimonApp_ProcessEvent_13
    360            {
    361              // Send "the" message
    362              SimonApp_SendTheMessage();
   \   0000B6                ; Setup parameters for call to function SimonApp_SendTheMessage
   \   0000B6   12....       LCALL   ??SimonApp_SendTheMessage?relay
    363          
    364              // Setup to send message again
    365              //osal_start_timerEx( SimonApp_TaskID,
    366          //                        SimonApp_SEND_MSG_EVT,
    367          //                      SimonApp_SEND_MSG_TIMEOUT );
    368          
    369              // return unprocessed events
    370          //    P0_1 = 0;//µãÁÁLED2
    371          //    keyChange_t *msgPtr;
    372          //    msgPtr = (keyChange_t *)osal_msg_allocate( sizeof(keyChange_t) );
    373          //    if ( msgPtr )
    374          //    {
    375          //      msgPtr->hdr.event = KEY_CHANGE;
    376          //       msgPtr->keys=3;
    377          //    
    378          //      osal_msg_send( SimonApp_TaskID, (uint8 *)msgPtr );
    379          //    }
    380              return (events ^ SimonApp_SEND_MSG_EVT);
   \   0000B9   E5..         MOV     A,?V0 + 0
   \   0000BB   6401         XRL     A,#0x1
   \   0000BD   80ED         SJMP    ??SimonApp_ProcessEvent_12
    381            }
    382          
    383            // Discard unknown events
    384            return 0;
   \                     ??SimonApp_ProcessEvent_13:
   \   0000BF   7A00         MOV     R2,#0x0
   \   0000C1   7B00         MOV     R3,#0x0
   \                     ??SimonApp_ProcessEvent_10:
   \   0000C3                REQUIRE ?Subroutine1
   \   0000C3                ; // Fall through to label ?Subroutine1
    385          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F04         MOV     R7,#0x4
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    386          
    387          /*********************************************************************
    388           * Event Generation Functions
    389           */
    390          
    391          /*********************************************************************
    392           * @fn      SimonApp_ProcessZDOMsgs()
    393           *
    394           * @brief   Process response messages
    395           *
    396           * @param   none
    397           *
    398           * @return  none
    399           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    400          void SimonApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
   \                     SimonApp_ProcessZDOMsgs:
    401          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    402            switch ( inMsg->clusterID )
   \   000005   EA           MOV     A,R2
   \   000006   240C         ADD     A,#0xc
   \   000008   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   00000B   78..         MOV     R0,#?V0 + 0
   \   00000D   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for SimonApp_ProcessZDOMsgs>_0`:
   \   000010   0000         DW        0
   \   000012   0200         DW        2
   \   000014   0680         DW        32774
   \   000016   ....         DW        ??SimonApp_ProcessZDOMsgs_0
   \   000018   2080         DW        32800
   \   00001A   ....         DW        ??SimonApp_ProcessZDOMsgs_1
   \   00001C   ....         DW        ??SimonApp_ProcessZDOMsgs_2
    403            {
    404              case End_Device_Bind_rsp:
    405                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
   \                     ??SimonApp_ProcessZDOMsgs_1:
   \   00001E   EA           MOV     A,R2
   \   00001F   2413         ADD     A,#0x13
   \   000021   F582         MOV     DPL,A
   \   000023   EB           MOV     A,R3
   \   000024   3400         ADDC    A,#0x0
   \   000026   F583         MOV     DPH,A
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F8           MOV     R0,A
   \   00002A   A3           INC     DPTR
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F583         MOV     DPH,A
   \   00002E   8882         MOV     DPL,R0
   \   000030   E0           MOVX    A,@DPTR
   \   000031   7009         JNZ     ??SimonApp_ProcessZDOMsgs_3
    406                {
    407                  // Light LED
    408                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   000033                ; Setup parameters for call to function HalLedSet
   \   000033   7A01         MOV     R2,#0x1
   \                     ??SimonApp_ProcessZDOMsgs_4:
   \   000035   7908         MOV     R1,#0x8
   \   000037   12....       LCALL   ??HalLedSet?relay
   \   00003A   8053         SJMP    ??SimonApp_ProcessZDOMsgs_2
    409                }
    410          #if defined(BLINK_LEDS)
    411                else
    412                {
    413                  // Flash LED to show failure
    414                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
   \                     ??SimonApp_ProcessZDOMsgs_3:
   \   00003C                ; Setup parameters for call to function HalLedSet
   \   00003C   7A04         MOV     R2,#0x4
   \   00003E   80F5         SJMP    ??SimonApp_ProcessZDOMsgs_4
    415                }
    416          #endif
    417                break;
    418          
    419              case Match_Desc_rsp:
    420                {
    421                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
   \                     ??SimonApp_ProcessZDOMsgs_0:
   \   000040                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   000040   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   000043   8A..         MOV     ?V0 + 0,R2
   \   000045   8B..         MOV     ?V0 + 1,R3
   \   000047   AE..         MOV     R6,?V0 + 0
   \   000049   AF..         MOV     R7,?V0 + 1
    422                  if ( pRsp )
   \   00004B   EE           MOV     A,R6
   \   00004C   4F           ORL     A,R7
   \   00004D   6040         JZ      ??SimonApp_ProcessZDOMsgs_2
    423                  {
    424                    if ( pRsp->status == ZSuccess && pRsp->cnt )
   \   00004F   8E82         MOV     DPL,R6
   \   000051   8F83         MOV     DPH,R7
   \   000053   E0           MOVX    A,@DPTR
   \   000054   7032         JNZ     ??SimonApp_ProcessZDOMsgs_5
   \   000056   A3           INC     DPTR
   \   000057   A3           INC     DPTR
   \   000058   A3           INC     DPTR
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   602C         JZ      ??SimonApp_ProcessZDOMsgs_5
    425                    {
    426                      SimonApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   00005C   90....       MOV     DPTR,#SimonApp_DstAddr + 8
   \   00005F   7402         MOV     A,#0x2
   \   000061   F0           MOVX    @DPTR,A
    427                      SimonApp_DstAddr.addr.shortAddr = pRsp->nwkAddr;
   \   000062   8E82         MOV     DPL,R6
   \   000064   8F83         MOV     DPH,R7
   \   000066   A3           INC     DPTR
   \   000067   E0           MOVX    A,@DPTR
   \   000068   F8           MOV     R0,A
   \   000069   A3           INC     DPTR
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   F9           MOV     R1,A
   \   00006C   90....       MOV     DPTR,#SimonApp_DstAddr
   \   00006F   E8           MOV     A,R0
   \   000070   F0           MOVX    @DPTR,A
   \   000071   A3           INC     DPTR
   \   000072   E9           MOV     A,R1
   \   000073   F0           MOVX    @DPTR,A
    428                      // Take the first endpoint, Can be changed to search through endpoints
    429                      SimonApp_DstAddr.endPoint = pRsp->epList[0];
   \   000074   8E82         MOV     DPL,R6
   \   000076   8F83         MOV     DPH,R7
   \   000078   A3           INC     DPTR
   \   000079   A3           INC     DPTR
   \   00007A   A3           INC     DPTR
   \   00007B   A3           INC     DPTR
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   90....       MOV     DPTR,#SimonApp_DstAddr + 9
   \   000080   F0           MOVX    @DPTR,A
    430          
    431                      // Light LED
    432                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   000081                ; Setup parameters for call to function HalLedSet
   \   000081   7A01         MOV     R2,#0x1
   \   000083   7908         MOV     R1,#0x8
   \   000085   12....       LCALL   ??HalLedSet?relay
    433                    }
    434                    osal_mem_free( pRsp );
   \                     ??SimonApp_ProcessZDOMsgs_5:
   \   000088                ; Setup parameters for call to function osal_mem_free
   \   000088   EE           MOV     A,R6
   \   000089   FA           MOV     R2,A
   \   00008A   EF           MOV     A,R7
   \   00008B   FB           MOV     R3,A
   \   00008C   12....       LCALL   ??osal_mem_free?relay
    435                  }
    436                }
    437                break;
    438            }
    439          }
   \                     ??SimonApp_ProcessZDOMsgs_2:
   \   00008F                REQUIRE ?Subroutine2
   \   00008F                ; // Fall through to label ?Subroutine2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   F582         MOV     DPL,A
   \   000002   EB           MOV     A,R3
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   F5..         MOV     ?V0 + 0,A
   \   00000A   A3           INC     DPTR
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F5..         MOV     ?V0 + 1,A
   \   00000E   22           RET
    440          
    441          /*********************************************************************
    442           * @fn      SimonApp_HandleKeys
    443           *
    444           * @brief   Handles all key events for this device.
    445           *
    446           * @param   shift - true if in shift/alt.
    447           * @param   keys - bit field for key events. Valid entries:
    448           *                 HAL_KEY_SW_4
    449           *                 HAL_KEY_SW_3
    450           *                 HAL_KEY_SW_2
    451           *                 HAL_KEY_SW_1
    452           *
    453           * @return  none
    454           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    455          void SimonApp_HandleKeys( byte shift, byte keys )
   \                     SimonApp_HandleKeys:
    456          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
    457            zAddrType_t dstAddr;
                               ^
Warning[Pe177]: variable "dstAddr" was declared but never referenced
    458            
    459            LS164_BYTE(keys);
   \   000006                ; Setup parameters for call to function LS164_BYTE
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??LS164_BYTE?relay
    460            
    461            // Shift is used to make each button/switch dual purpose.
    462            if ( shift )
    463            {
    464              if ( keys & HAL_KEY_SW_1 )
    465              {
    466              }
    467              if ( keys & HAL_KEY_SW_2 )
    468              {
    469              }
    470              if ( keys & HAL_KEY_SW_3 )
    471              {
    472              }
    473              if ( keys & HAL_KEY_SW_4 )
    474              {
    475              }
    476            }
    477            else
    478            {
    479              if ( keys & HAL_KEY_SW_1 )
    480              {
    481              }
    482          
    483              if ( keys & HAL_KEY_SW_2 )
    484              {
    485          //      HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    486          //
    487          //      // Initiate an End Device Bind Request for the mandatory endpoint
    488          //      dstAddr.addrMode = Addr16Bit;
    489          //      dstAddr.addr.shortAddr = 0x0000; // Coordinator
    490          //      ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(), 
    491          //                            SimonApp_epDesc.endPoint,
    492          //                            SimonApp_PROFID,
    493          //                            SimonApp_MAX_CLUSTERS, (cId_t *)SimonApp_ClusterList,
    494          //                            SimonApp_MAX_CLUSTERS, (cId_t *)SimonApp_ClusterList,
    495          //                            FALSE );
    496              }
    497          
    498              if ( keys & HAL_KEY_SW_3 )
    499              {
    500              }
    501          
    502              if ( keys & HAL_KEY_SW_4 )
    503              {
    504          //      HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    505          //      // Initiate a Match Description Request (Service Discovery)
    506          //      dstAddr.addrMode = AddrBroadcast;
    507          //      dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    508          //      ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    509          //                        SimonApp_PROFID,
    510          //                        SimonApp_MAX_CLUSTERS, (cId_t *)SimonApp_ClusterList,
    511          //                        SimonApp_MAX_CLUSTERS, (cId_t *)SimonApp_ClusterList,
    512          //                        FALSE );
    513              }
    514            }
    515          }
   \   00000A   02....       LJMP    ?Subroutine0 & 0xFFFF
    516          
    517          /*********************************************************************
    518           * LOCAL FUNCTIONS
    519           */
    520          
    521          /*********************************************************************
    522           * @fn      SimonApp_MessageMSGCB
    523           *
    524           * @brief   Data message processor callback.  This function processes
    525           *          any incoming data - probably from other devices.  So, based
    526           *          on cluster ID, perform the intended action.
    527           *
    528           * @param   none
    529           *
    530           * @return  none
    531           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    532          void SimonApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     SimonApp_MessageMSGCB:
    533          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
    534            switch ( pkt->clusterId )
   \   000005   8A82         MOV     DPL,R2
   \   000007   8B83         MOV     DPH,R3
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6401         XRL     A,#0x1
   \   000010   7002         JNZ     ??SimonApp_MessageMSGCB_0
   \   000012   A3           INC     DPTR
   \   000013   E0           MOVX    A,@DPTR
   \                     ??SimonApp_MessageMSGCB_0:
   \   000014   703A         JNZ     ??SimonApp_MessageMSGCB_1
    535            {
    536              case SimonApp_CLUSTERID:
    537                // "the" message
    538          //#if defined( LCD_SUPPORTED )
    539          //      HalLcdWriteScreen( (char*)pkt->cmd.Data, "rcvd" );
    540          //#elif defined( WIN32 )
    541          //      WPRINTSTR( pkt->cmd.Data );
    542          //#endif
    543                osal_memcpy(uartbuf,(unsigned char*)pkt->cmd.Data,pkt->cmd.DataLength);
   \   000016   EA           MOV     A,R2
   \   000017   241F         ADD     A,#0x1f
   \   000019   F8           MOV     R0,A
   \   00001A   EB           MOV     A,R3
   \   00001B   3400         ADDC    A,#0x0
   \   00001D   F9           MOV     R1,A
   \   00001E   E8           MOV     A,R0
   \   00001F   FE           MOV     R6,A
   \   000020   E9           MOV     A,R1
   \   000021   FF           MOV     R7,A
   \   000022                ; Setup parameters for call to function osal_memcpy
   \   000022   EA           MOV     A,R2
   \   000023   2421         ADD     A,#0x21
   \   000025   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000028   75..00       MOV     ?V0 + 2,#0x0
   \   00002B   78..         MOV     R0,#?V0 + 0
   \   00002D   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000030   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000033   12....       LCALL   ??osal_memcpy?relay
   \   000036   7403         MOV     A,#0x3
   \   000038   12....       LCALL   ?DEALLOC_XSTACK8
    544                HalUARTWrite(0,uartbuf,pkt->cmd.DataLength);
   \   00003B                ; Setup parameters for call to function HalUARTWrite
   \   00003B   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   00003E   7900         MOV     R1,#0x0
   \   000040   12....       LCALL   ??HalUARTWrite?relay
    545                osal_memset(uartbuf,0,UART_MAX);
   \   000043                ; Setup parameters for call to function osal_memset
   \   000043   7C70         MOV     R4,#0x70
   \   000045   7D00         MOV     R5,#0x0
   \   000047   7900         MOV     R1,#0x0
   \   000049   7A..         MOV     R2,#uartbuf & 0xff
   \   00004B   7B..         MOV     R3,#(uartbuf >> 8) & 0xff
   \   00004D   12....       LCALL   ??osal_memset?relay
    546                break;
    547            }
    548          }
   \                     ??SimonApp_MessageMSGCB_1:
   \   000050   7F03         MOV     R7,#0x3
   \   000052   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   8E82         MOV     DPL,R6
   \   000002   8F83         MOV     DPH,R7
   \   000004   E0           MOVX    A,@DPTR
   \   000005   FC           MOV     R4,A
   \   000006   A3           INC     DPTR
   \   000007   E0           MOVX    A,@DPTR
   \   000008   FD           MOV     R5,A
   \   000009   7A..         MOV     R2,#uartbuf & 0xff
   \   00000B   7B..         MOV     R3,#(uartbuf >> 8) & 0xff
   \   00000D   22           RET
    549          
    550          /*********************************************************************
    551           * @fn      SimonApp_SendTheMessage
    552           *
    553           * @brief   Send "the" message.
    554           *
    555           * @param   none
    556           *
    557           * @return  none
    558           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    559          void SimonApp_SendTheMessage( void )
   \                     SimonApp_SendTheMessage:
    560          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 12
   \   000005   74F4         MOV     A,#-0xc
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    561            char theMessageData[] = "Hello World";
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AC82         MOV     R4,DPL
   \   000012   AD83         MOV     R5,DPH
   \   000014   7583..       MOV     DPH,#(`?<Constant "Hello World">` >> 8) & 0xff
   \   000017   7582..       MOV     DPL,#`?<Constant "Hello World">` & 0xff
   \   00001A   740C         MOV     A,#0xc
   \   00001C   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    562           
    563          
    564            if ( AF_DataRequest( &SimonApp_DstAddr, &SimonApp_epDesc,
    565                                 SimonApp_CLUSTERID,
    566                                 (byte)osal_strlen( theMessageData ) + 1,
    567                                 (byte *)&theMessageData,
    568                                 &SimonApp_TransID,
    569                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   00001F                ; Setup parameters for call to function AF_DataRequest
   \   00001F   75..1E       MOV     ?V0 + 0,#0x1e
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000027   75....       MOV     ?V0 + 0,#SimonApp_TransID & 0xff
   \   00002A   75....       MOV     ?V0 + 1,#(SimonApp_TransID >> 8) & 0xff
   \   00002D   78..         MOV     R0,#?V0 + 0
   \   00002F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000032   7403         MOV     A,#0x3
   \   000034   12....       LCALL   ?XSTACK_DISP0_8
   \   000037   8582..       MOV     ?V0 + 0,DPL
   \   00003A   8583..       MOV     ?V0 + 1,DPH
   \   00003D   78..         MOV     R0,#?V0 + 0
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000042                ; Setup parameters for call to function osal_strlen
   \   000042   7405         MOV     A,#0x5
   \   000044   12....       LCALL   ?XSTACK_DISP0_8
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   12....       LCALL   ??osal_strlen?relay
   \   00004E   EA           MOV     A,R2
   \   00004F   2401         ADD     A,#0x1
   \   000051   F5..         MOV     ?V0 + 0,A
   \   000053   E4           CLR     A
   \   000054   3400         ADDC    A,#0x0
   \   000056   F5..         MOV     ?V0 + 1,A
   \   000058   78..         MOV     R0,#?V0 + 0
   \   00005A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005D   75..01       MOV     ?V0 + 0,#0x1
   \   000060   75..00       MOV     ?V0 + 1,#0x0
   \   000063   78..         MOV     R0,#?V0 + 0
   \   000065   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000068   7920         MOV     R1,#0x20
   \   00006A   7C..         MOV     R4,#SimonApp_epDesc & 0xff
   \   00006C   7D..         MOV     R5,#(SimonApp_epDesc >> 8) & 0xff
   \   00006E   7A..         MOV     R2,#SimonApp_DstAddr & 0xff
   \   000070   7B..         MOV     R3,#(SimonApp_DstAddr >> 8) & 0xff
   \   000072   12....       LCALL   ??AF_DataRequest?relay
   \   000075   7409         MOV     A,#0x9
   \   000077   12....       LCALL   ?DEALLOC_XSTACK8
    570            {
    571              // Successfully requested to be sent.
    572              //HalUARTWrite(0,"OK\n",3);
    573            }
    574            else
    575            {
    576              // Error occurred in request to send.
    577              //HalUARTWrite(0,"KO\n",3);
    578            }
    579          }
   \   00007A   740C         MOV     A,#0xc
   \   00007C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00007F   02....       LJMP    ?Subroutine2 & 0xFFFF
    580          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    581          void SimonApp_SendTheSerial( void )
   \                     SimonApp_SendTheSerial:
    582          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 12
   \   000005   74F4         MOV     A,#-0xc
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    583            //char theMessageData[] = "Hello World";
    584            afAddrType_t my_DstAddr;
    585            byte len = 0;
    586            
    587            if(uartbuf[UART_MAX-1] != '\0')
   \   00000A   90....       MOV     DPTR,#uartbuf + 111
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6005         JZ      ??SimonApp_SendTheSerial_0
    588            {
    589               len = UART_MAX; 
   \   000010   75..70       MOV     ?V0 + 0,#0x70
   \   000013   800A         SJMP    ??SimonApp_SendTheSerial_1
    590            }else{
    591               len = osal_strlen( (char *)uartbuf ); 
   \                     ??SimonApp_SendTheSerial_0:
   \   000015                ; Setup parameters for call to function osal_strlen
   \   000015   7A..         MOV     R2,#uartbuf & 0xff
   \   000017   7B..         MOV     R3,#(uartbuf >> 8) & 0xff
   \   000019   12....       LCALL   ??osal_strlen?relay
   \   00001C   EA           MOV     A,R2
   \   00001D   F5..         MOV     ?V0 + 0,A
    592            }
    593            
    594            my_DstAddr.addrMode = (afAddrMode_t)Addr16Bit; 
   \                     ??SimonApp_SendTheSerial_1:
   \   00001F   7408         MOV     A,#0x8
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7402         MOV     A,#0x2
   \   000026   F0           MOVX    @DPTR,A
    595            my_DstAddr.endPoint = SimonApp_ENDPOINT;
   \   000027   7409         MOV     A,#0x9
   \   000029   12....       LCALL   ?XSTACK_DISP0_8
   \   00002C   740A         MOV     A,#0xa
   \   00002E   F0           MOVX    @DPTR,A
    596            my_DstAddr.addr.shortAddr = 0x0000;
   \   00002F   85..82       MOV     DPL,?XSP + 0
   \   000032   85..83       MOV     DPH,?XSP + 1
   \   000035   E4           CLR     A
   \   000036   F0           MOVX    @DPTR,A
   \   000037   A3           INC     DPTR
   \   000038   F0           MOVX    @DPTR,A
    597            
    598          
    599            if ( AF_DataRequest( &my_DstAddr, &SimonApp_epDesc,
    600                                 SimonApp_CLUSTERID,
    601                                 len,
    602                                 uartbuf,
    603                                 &SimonApp_TransID,
    604                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   000039                ; Setup parameters for call to function AF_DataRequest
   \   000039   75..1E       MOV     ?V0 + 1,#0x1e
   \   00003C   78..         MOV     R0,#?V0 + 1
   \   00003E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000041   75....       MOV     ?V0 + 2,#SimonApp_TransID & 0xff
   \   000044   75....       MOV     ?V0 + 3,#(SimonApp_TransID >> 8) & 0xff
   \   000047   78..         MOV     R0,#?V0 + 2
   \   000049   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004C   75....       MOV     ?V0 + 2,#uartbuf & 0xff
   \   00004F   75....       MOV     ?V0 + 3,#(uartbuf >> 8) & 0xff
   \   000052   78..         MOV     R0,#?V0 + 2
   \   000054   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000057   75..00       MOV     ?V0 + 1,#0x0
   \   00005A   78..         MOV     R0,#?V0 + 0
   \   00005C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005F   75..01       MOV     ?V0 + 0,#0x1
   \   000062   78..         MOV     R0,#?V0 + 0
   \   000064   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000067   7920         MOV     R1,#0x20
   \   000069   7C..         MOV     R4,#SimonApp_epDesc & 0xff
   \   00006B   7D..         MOV     R5,#(SimonApp_epDesc >> 8) & 0xff
   \   00006D   7409         MOV     A,#0x9
   \   00006F   12....       LCALL   ?XSTACK_DISP0_8
   \   000072   AA82         MOV     R2,DPL
   \   000074   AB83         MOV     R3,DPH
   \   000076   12....       LCALL   ??AF_DataRequest?relay
   \   000079   7409         MOV     A,#0x9
   \   00007B   12....       LCALL   ?DEALLOC_XSTACK8
    605            {
    606              // Successfully requested to be sent.
    607              //HalUARTWrite(0,"OK\n",3);
    608            }
    609            else
    610            {
    611              // Error occurred in request to send.
    612              //HalUARTWrite(0,"KO\n",3);
    613            }
    614          }
   \   00007E   740C         MOV     A,#0xc
   \   000080   12....       LCALL   ?DEALLOC_XSTACK8
   \   000083   02....       LJMP    ?Subroutine1 & 0xFFFF
    615          
    616          /*********************************************************************
    617          *********************************************************************/
    618          
    619          
    620          /*added by Simon*/
    621          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    622          static void rxCB(uint8 port,uint8 event)
   \                     rxCB:
    623          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    624              osal_memset(uartbuf,0,UART_MAX);
   \   000004                ; Setup parameters for call to function osal_memset
   \   000004   7C70         MOV     R4,#0x70
   \   000006   7D00         MOV     R5,#0x0
   \   000008   7900         MOV     R1,#0x0
   \   00000A   7A..         MOV     R2,#uartbuf & 0xff
   \   00000C   7B..         MOV     R3,#(uartbuf >> 8) & 0xff
   \   00000E   12....       LCALL   ??osal_memset?relay
    625              HalUARTRead(0,uartbuf,UART_MAX);
   \   000011                ; Setup parameters for call to function HalUARTRead
   \   000011   7C70         MOV     R4,#0x70
   \   000013   7D00         MOV     R5,#0x0
   \   000015   7A..         MOV     R2,#uartbuf & 0xff
   \   000017   7B..         MOV     R3,#(uartbuf >> 8) & 0xff
   \   000019   7900         MOV     R1,#0x0
   \   00001B   12....       LCALL   ??HalUARTRead?relay
    626          //    if(osal_memcmp(uartbuf,"lzj",3))
    627          //    {
    628          //      HalUARTWrite(0,uartbuf,3);
    629          //    }
    630              if(DEV_FLAG == 3)
   \   00001E   90....       MOV     DPTR,#DEV_FLAG
   \   000021   E0           MOVX    A,@DPTR
   \   000022   6403         XRL     A,#0x3
   \   000024   700C         JNZ     ??rxCB_0
    631                osal_set_event(SimonApp_TaskID,Serial_CallBack_EVT);
   \   000026                ; Setup parameters for call to function osal_set_event
   \   000026   7A02         MOV     R2,#0x2
   \   000028   7B00         MOV     R3,#0x0
   \   00002A   90....       MOV     DPTR,#SimonApp_TaskID
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   F9           MOV     R1,A
   \   00002F   12....       LCALL   ??osal_set_event?relay
    632          }
   \                     ??rxCB_0:
   \   000032   D083         POP     DPH
   \   000034   D082         POP     DPL
   \   000036   02....       LJMP    ?BRET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SimonApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SimonApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SimonApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SimonApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SimonApp_ProcessZDOMsgs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SimonApp_ProcessZDOMsgs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SimonApp_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SimonApp_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SimonApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SimonApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SimonApp_SendTheMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SimonApp_SendTheMessage

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SimonApp_SendTheSerial?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SimonApp_SendTheSerial

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??rxCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    rxCB

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "SimonApp">`:
   \   000000   53696D6F     DB "SimonApp"
   \            6E417070
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Hello World">`:
   \   000000   48656C6C     DB "Hello World"
   \            6F20576F
   \            726C6400
    633          
    634          /******************************************/

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     SimonApp_HandleKeys              0      0      9
       -> LS164_BYTE                  0      0     18
     SimonApp_Init                    0      0     38
       -> afRegister                  0      0     76
       -> HalUARTOpen                 0      0     76
       -> RegisterForKeys             0      0     76
       -> HalLcdWriteString           0      0     76
       -> ZDO_RegisterForZDOMsg       0      0     76
       -> ZDO_RegisterForZDOMsg       0      0     76
     SimonApp_MessageMSGCB            0      0     26
       -> osal_memcpy                 0      0     28
       -> HalUARTWrite                0      0     22
       -> osal_memset                 0      0     22
     SimonApp_ProcessEvent            0      0     12
       -> osal_msg_receive            0      0     24
       -> LS164_BYTE                  0      0     24
       -> LS164_BYTE                  0      0     24
       -> LS164_BYTE                  0      0     24
       -> osal_msg_deallocate         0      0     24
       -> osal_msg_receive            0      0     24
       -> SimonApp_ProcessZDOMsgs     0      0     24
       -> LS164_BYTE                  0      0     24
       -> SimonApp_MessageMSGCB       0      0     24
       -> SimonApp_SendTheSerial      0      0     24
       -> SimonApp_SendTheMessage     0      0     24
     SimonApp_ProcessZDOMsgs          0      0     22
       -> HalLedSet                   0      0     20
       -> HalLedSet                   0      0     20
       -> ZDO_ParseEPListRsp          0      0     20
       -> HalLedSet                   0      0     20
       -> osal_mem_free               0      0     20
     SimonApp_SendTheMessage          2      0     43
       -> osal_strlen                 0      0     54
       -> AF_DataRequest              0      0     62
     SimonApp_SendTheSerial           0      0     45
       -> osal_strlen                 0      0     48
       -> AF_DataRequest              0      0     66
     rxCB                             2      0      0
       -> osal_memset                 4      0      0
       -> HalUARTRead                 4      0      0
       -> osal_set_event              4      0      0


   Segment part sizes:

     Function/Label                  Bytes
     --------------                  -----
     SimonApp_ClusterList               2
     SimonApp_SimpleDesc               12
     SimonApp_epDesc                    6
     SimonApp_TaskID                    1
     SimonApp_NwkState                  1
     SimonApp_TransID                   1
     SimonApp_DstAddr                  12
     uartbuf                          112
     DEV_FLAG                           1
     SimonApp_Init                    165
     ?Subroutine0                       5
     SimonApp_ProcessEvent            195
     ?Subroutine1                       5
     SimonApp_ProcessZDOMsgs          143
     ?Subroutine2                       5
     ?Subroutine3                      15
     SimonApp_HandleKeys               13
     SimonApp_MessageMSGCB             85
     ?Subroutine4                      14
     SimonApp_SendTheMessage          130
     SimonApp_SendTheSerial           134
     rxCB                              57
     ??SimonApp_Init?relay              6
     ??SimonApp_ProcessEvent?relay      6
     ??SimonApp_ProcessZDOMsgs?relay    6
     ??SimonApp_HandleKeys?relay        6
     ??SimonApp_MessageMSGCB?relay      6
     ??SimonApp_SendTheMessage?relay    6
     ??SimonApp_SendTheSerial?relay     6
     ??rxCB?relay                       6
     ?<Constant "SimonApp">             9
     ?<Constant "Hello World">         12

 
 966 bytes in segment BANKED_CODE
  48 bytes in segment BANK_RELAYS
  35 bytes in segment XDATA_ROM_C
 134 bytes in segment XDATA_Z
 
 1 014 bytes of CODE  memory
    35 bytes of CONST memory
   134 bytes of XDATA memory

Errors: none
Warnings: 1
